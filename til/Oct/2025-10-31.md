# TIL

## 날짜: 2025-10-31

### 스크럼
- 학습 목표 1 : Query Method에 대한 이해 가져가기
- 학습 목표 2 : @EntityGraph 이해하기

### 새로 배운 내용
#### 주제 1: Query Method
- Spring Data JPA가 제공하는 Query Method를 활용하면 편하게 메소드를 작성해서 사용할 수 있지만, 항상 최적의 성능을 제공한는 것은 아니므로 실제 실행되는 쿼리를 활용해볼 필요가 있다.

#### 주제 2: Fetch Join
- Fetch Join시에 내부적으로 옵티마이저가 실행 계획을 변경할 수도 있지만, 대부분 INNER JOIN을 통해서 JOIN이 일어나게되는데 이는 데이터를 누락시키는 위험이 있을 수 있다.

#### 주제 3: @EntityGraph
- Fetch Join과 동일하게 INNER JOIN으로 인행 데이터가 누락되는 문제가 발생할 수 있다. 그렇다고 LEFT OUTER JOIN을 사용하게되면 중복 데이터 늘어나서 성능에 문제나 부담이 있을 수 있다.

#### 주제 4: @BatchSize
- Batch단위로 쿼리를 보내서 쿼리 개수를 줄이는 방법이지만 N+1문제를 완벽하게 해결하지는 못한다.
- 기존에 진행했던 UKET이라는 프로젝트에서 티켓 조회 기능을 구현한 경험이 있다. 당시에 중심 엔티티인 티켓 테이블을 중심으로 유저,행사 정보 테이블에서 데이터를 가져와서 DTO를 만들어야해 N+1문제가 발생했다. 쿼리 수를 줄이기 위해 티켓을 먼저 조회하고 해당 ID들을 추출해 유저와 행사정보를 IN쿼리를 활용해 추출했는데 거기에 BatchSize를 적용해 IN쿼리의 안티패턴을 피하는 방향으로 리팩토링하면 좋을 것 같다.

### 오늘의 도전 과제와 해결 방법
- 도전 과제 1: 직접 N+1 상황을 마주하고 각 해별방법을 도입해서 해결해보기 / 데이터셋을 먼저 세팅한 후에 Fetch Join, @EntityGraph, @BatchSize 3가지 경우로 나누어서 작업 진행해보면 될 것 같다. 
- 도전 과제 2:

### 오늘의 회고
- 딥다이브 발표와 모의 면접을 준비하면서 N+1이라는 문제를 마주했을 때 내가 어떤 상황에서 어떤 전략을 취해야하는지에 대한 인사이트가 넓어져서 좋다. 단순히 컬렉션 테이블2개가 있으면 fetch join이 힘들다는 사실만을 인지하는 것이 아니라 어떤 이유에서 해당 내용이 힘든지를 이해하고 그래서 대안을 찾는 등 기술전 선택을 함에 있어서 이해의 폭이 점점 넓어져가는 느낌이라 좋다.

### 참고 자료 및 링크
- 
